use super::Sampler;

pub struct HaltonSampler {
    seq1: std::sync::Mutex<halton::Sequence>,
    seq2: std::sync::Mutex<halton::Sequence>
}

impl HaltonSampler {
    pub fn new() -> Self {
        Self {
            seq1: std::sync::Mutex::new(halton::Sequence::new(2)),
            seq2: std::sync::Mutex::new(halton::Sequence::new(2))
        }
    }

    fn next(&self) -> (f64, f64) {
        let a = self.seq1.lock().as_mut().ok()
            .and_then(|guard| guard.next())
            .unwrap_or(0.);
        let b = self.seq2.lock().as_mut().ok()
            .and_then(|guard| guard.next())
            .unwrap_or(0.);
        (a, b)
    }
}

impl Default for HaltonSampler {
    fn default() -> Self {
        Self::new()
    }
}

impl Sampler for HaltonSampler {
    fn hemisphere(&self) -> nalgebra_glm::DVec3 {
        let (u1, u2) = self.next();
        let r = (1.0 - u1.powi(2)).sqrt();
        let phi = 2. * std::f64::consts::PI * u2;
        nalgebra_glm::DVec3::new(phi.cos() * r, phi.sin() * r, u1)
    }
}

#[cfg(test)]
mod test {
    use super::*;
    use approx::AbsDiffEq;

    #[test]
    fn halton_hemisphere() {
        let halton = HaltonSampler::new();
        (0..256).zip(
            // Generated using C++ code
            vec![
                nalgebra_glm::DVec3::new(-0.866025404, -0.000000000, 0.500000000),
                nalgebra_glm::DVec3::new(-0.000000000, 0.968245837, 0.250000000),
                nalgebra_glm::DVec3::new(0.000000000, -0.661437828, 0.750000000),
                nalgebra_glm::DVec3::new(0.701560760, 0.701560760, 0.125000000),
                nalgebra_glm::DVec3::new(-0.551985054, -0.551985054, 0.625000000),
                nalgebra_glm::DVec3::new(-0.655505530, 0.655505530, 0.375000000),
                nalgebra_glm::DVec3::new(0.342326598, -0.342326598, 0.875000000),
                nalgebra_glm::DVec3::new(0.922073315, 0.381935272, 0.062500000),
                nalgebra_glm::DVec3::new(-0.763861089, -0.316401623, 0.562500000),
                nalgebra_glm::DVec3::new(-0.363517789, 0.877609576, 0.312500000),
                nalgebra_glm::DVec3::new(0.223089589, -0.538585912, 0.812500000),
                nalgebra_glm::DVec3::new(0.375896390, 0.907494162, 0.187500000),
                nalgebra_glm::DVec3::new(-0.277898730, -0.670906883, 0.687500000),
                nalgebra_glm::DVec3::new(-0.830769485, 0.344115988, 0.437500000),
                nalgebra_glm::DVec3::new(0.321496471, -0.133168199, 0.937500000),
                nalgebra_glm::DVec3::new(0.980306264, 0.194995040, 0.031250000),
                nalgebra_glm::DVec3::new(-0.830936106, -0.165283468, 0.531250000),
                nalgebra_glm::DVec3::new(-0.187215410, 0.941195425, 0.281250000),
                nalgebra_glm::DVec3::new(0.121778942, -0.612224082, 0.781250000),
                nalgebra_glm::DVec3::new(0.548746463, 0.821257119, 0.156250000),
                nalgebra_glm::DVec3::new(-0.419201924, -0.627380016, 0.656250000),
                nalgebra_glm::DVec3::new(-0.759765311, 0.507658950, 0.406250000),
                nalgebra_glm::DVec3::new(0.351497263, -0.234862963, 0.906250000),
                nalgebra_glm::DVec3::new(0.827807629, 0.553123374, 0.093750000),
                nalgebra_glm::DVec3::new(-0.669041670, -0.447039352, 0.593750000),
                nalgebra_glm::DVec3::new(-0.521714450, 0.780800852, 0.343750000),
                nalgebra_glm::DVec3::new(0.298194754, -0.446279987, 0.843750000),
                nalgebra_glm::DVec3::new(0.190365417, 0.957031580, 0.218750000),
                nalgebra_glm::DVec3::new(-0.135640177, -0.681909217, 0.718750000),
                nalgebra_glm::DVec3::new(-0.866357921, 0.172329305, 0.468750000),
                nalgebra_glm::DVec3::new(0.243273182, -0.048390045, 0.968750000),
                nalgebra_glm::DVec3::new(0.995063237, 0.098005175, 0.015625000),
                nalgebra_glm::DVec3::new(-0.852688572, -0.083982494, 0.515625000),
                nalgebra_glm::DVec3::new(-0.094496015, 0.959434137, 0.265625000),
                nalgebra_glm::DVec3::new(0.063053167, -0.640189548, 0.765625000),
                nalgebra_glm::DVec3::new(0.628089275, 0.765328996, 0.140625000),
                nalgebra_glm::DVec3::new(-0.487121356, -0.593559090, 0.640625000),
                nalgebra_glm::DVec3::new(-0.711594692, 0.583990671, 0.390625000),
                nalgebra_glm::DVec3::new(0.351517619, -0.288483055, 0.890625000),
                nalgebra_glm::DVec3::new(0.879225735, 0.469955946, 0.078125000),
                nalgebra_glm::DVec3::new(-0.719602079, -0.384635324, 0.578125000),
                nalgebra_glm::DVec3::new(-0.445297532, 0.833093087, 0.328125000),
                nalgebra_glm::DVec3::new(0.264238364, -0.494355208, 0.828125000),
                nalgebra_glm::DVec3::new(0.284233059, 0.936990823, 0.203125000),
                nalgebra_glm::DVec3::new(-0.206411641, -0.680447991, 0.703125000),
                nalgebra_glm::DVec3::new(-0.853061581, 0.258773402, 0.453125000),
                nalgebra_glm::DVec3::new(0.289547967, -0.087833416, 0.953125000),
                nalgebra_glm::DVec3::new(0.955888432, 0.289965586, 0.046875000),
                nalgebra_glm::DVec3::new(-0.801164105, -0.243030474, 0.546875000),
                nalgebra_glm::DVec3::new(-0.277197584, 0.913797972, 0.296875000),
                nalgebra_glm::DVec3::new(0.175373809, -0.578129969, 0.796875000),
                nalgebra_glm::DVec3::new(0.464381772, 0.868797188, 0.171875000),
                nalgebra_glm::DVec3::new(-0.349146855, -0.653207822, 0.671875000),
                nalgebra_glm::DVec3::new(-0.799597446, 0.427393739, 0.421875000),
                nalgebra_glm::DVec3::new(0.341733377, -0.182660295, 0.921875000),
                nalgebra_glm::DVec3::new(0.768372822, 0.630587278, 0.109375000),
                nalgebra_glm::DVec3::new(-0.612906193, -0.502999113, 0.609375000),
                nalgebra_glm::DVec3::new(-0.592011520, 0.721368124, 0.359375000),
                nalgebra_glm::DVec3::new(0.324394392, -0.395275711, 0.859375000),
                nalgebra_glm::DVec3::new(0.095286997, 0.967465114, 0.234375000),
                nalgebra_glm::DVec3::new(-0.066528542, -0.675475619, 0.734375000),
                nalgebra_glm::DVec3::new(-0.870647788, 0.085751322, 0.484375000),
                nalgebra_glm::DVec3::new(0.175236911, -0.017259329, 0.984375000),
                nalgebra_glm::DVec3::new(0.998764975, 0.049066177, 0.007812500),
                nalgebra_glm::DVec3::new(-0.860429947, -0.042270213, 0.507812500),
                nalgebra_glm::DVec3::new(-0.047408940, 0.965031143, 0.257812500),
                nalgebra_glm::DVec3::new(0.032015303, -0.651686455, 0.757812500),
                nalgebra_glm::DVec3::new(0.665609735, 0.734387173, 0.132812500),
                nalgebra_glm::DVec3::new(-0.519991503, -0.573722212, 0.632812500),
                nalgebra_glm::DVec3::new(-0.684509959, 0.620403664, 0.382812500),
                nalgebra_glm::DVec3::new(0.348043673, -0.315448398, 0.882812500),
                nalgebra_glm::DVec3::new(0.901751932, 0.426496900, 0.070312500),
                nalgebra_glm::DVec3::new(-0.742561948, -0.351205645, 0.570312500),
                nalgebra_glm::DVec3::new(-0.405028043, 0.856359847, 0.320312500),
                nalgebra_glm::DVec3::new(0.244525409, -0.517005539, 0.820312500),
                nalgebra_glm::DVec3::new(0.330401712, 0.923410925, 0.195312500),
                nalgebra_glm::DVec3::new(-0.242125278, -0.676694818, 0.695312500),
                nalgebra_glm::DVec3::new(-0.843035221, 0.301642825, 0.445312500),
                nalgebra_glm::DVec3::new(0.307099687, -0.109882025, 0.945312500),
                nalgebra_glm::DVec3::new(0.969290896, 0.242794730, 0.039062500),
                nalgebra_glm::DVec3::new(-0.817024117, -0.204653887, 0.539062500),
                nalgebra_glm::DVec3::new(-0.232607411, 0.928620839, 0.289062500),
                nalgebra_glm::DVec3::new(0.149265865, -0.595902737, 0.789062500),
                nalgebra_glm::DVec3::new(0.507136624, 0.846106341, 0.164062500),
                nalgebra_glm::DVec3::new(-0.384382832, -0.641304011, 0.664062500),
                nalgebra_glm::DVec3::new(-0.780746140, 0.467961228, 0.414062500),
                nalgebra_glm::DVec3::new(0.347871870, -0.208506375, 0.914062500),
                nalgebra_glm::DVec3::new(0.799054274, 0.592619039, 0.101562500),
                nalgebra_glm::DVec3::new(-0.641622849, -0.475859936, 0.601562500),
                nalgebra_glm::DVec3::new(-0.557672490, 0.751934307, 0.351562500),
                nalgebra_glm::DVec3::new(0.312297205, -0.421084035, 0.851562500),
                nalgebra_glm::DVec3::new(0.142914988, 0.963454586, 0.226562500),
                nalgebra_glm::DVec3::new(-0.100818565, -0.679663557, 0.726562500),
                nalgebra_glm::DVec3::new(-0.869625224, 0.128996716, 0.476562500),
                nalgebra_glm::DVec3::new(0.212904437, -0.031581390, 0.976562500),
                nalgebra_glm::DVec3::new(0.988904787, 0.146690168, 0.023437500),
                nalgebra_glm::DVec3::new(-0.842841765, -0.125023766, 0.523437500),
                nalgebra_glm::DVec3::new(-0.141138543, 0.951478768, 0.273437500),
                nalgebra_glm::DVec3::new(0.093008423, -0.627011855, 0.773437500),
                nalgebra_glm::DVec3::new(0.589100023, 0.794309431, 0.148437500),
                nalgebra_glm::DVec3::new(-0.453486756, -0.611456107, 0.648437500),
                nalgebra_glm::DVec3::new(-0.736698322, 0.546372713, 0.398437500),
                nalgebra_glm::DVec3::new(0.352689569, -0.261572412, 0.898437500),
                nalgebra_glm::DVec3::new(0.854555469, 0.512200837, 0.085937500),
                nalgebra_glm::DVec3::new(-0.695065737, -0.416606370, 0.585937500),
                nalgebra_glm::DVec3::new(-0.484225293, 0.807881094, 0.335937500),
                nalgebra_glm::DVec3::new(0.282152258, -0.470742604, 0.835937500),
                nalgebra_glm::DVec3::new(0.237513017, 0.948205114, 0.210937500),
                nalgebra_glm::DVec3::new(-0.170877074, -0.682179519, 0.710937500),
                nalgebra_glm::DVec3::new(-0.860837358, 0.215628533, 0.460937500),
                nalgebra_glm::DVec3::new(0.268471148, -0.067248522, 0.960937500),
                nalgebra_glm::DVec3::new(0.940135062, 0.336385704, 0.054687500),
                nalgebra_glm::DVec3::new(-0.783419986, -0.280312153, 0.554687500),
                nalgebra_glm::DVec3::new(-0.320871541, 0.896775881, 0.304687500),
                nalgebra_glm::DVec3::new(0.200011034, -0.558993393, 0.804687500),
                nalgebra_glm::DVec3::new(0.420596097, 0.889275731, 0.179687500),
                nalgebra_glm::DVec3::new(-0.313612434, -0.663077781, 0.679687500),
                nalgebra_glm::DVec3::new(-0.816282136, 0.386072697, 0.429687500),
                nalgebra_glm::DVec3::new(0.332983756, -0.157489588, 0.929687500),
                nalgebra_glm::DVec3::new(0.735845830, 0.666931784, 0.117187500),
                nalgebra_glm::DVec3::new(-0.582992282, -0.528393404, 0.617187500),
                nalgebra_glm::DVec3::new(-0.624648510, 0.689193426, 0.367187500),
                nalgebra_glm::DVec3::new(0.334424115, -0.368980150, 0.867187500),
                nalgebra_glm::DVec3::new(0.047606903, 0.969060781, 0.242187500),
                nalgebra_glm::DVec3::new(-0.032884777, -0.669385021, 0.742187500),
                nalgebra_glm::DVec3::new(-0.869440668, 0.042712881, 0.492187500),
                nalgebra_glm::DVec3::new(0.124605347, -0.006121468, 0.992187500),
                nalgebra_glm::DVec3::new(0.999691192, 0.024541041, 0.003906250),
                nalgebra_glm::DVec3::new(-0.863498204, -0.021197691, 0.503906250),
                nalgebra_glm::DVec3::new(-0.023736984, 0.966937522, 0.253906250),
                nalgebra_glm::DVec3::new(0.016123146, -0.656784143, 0.753906250),
                nalgebra_glm::DVec3::new(0.683787560, 0.718204534, 0.128906250),
                nalgebra_glm::DVec3::new(-0.536104771, -0.563088450, 0.628906250),
                nalgebra_glm::DVec3::new(-0.670243644, 0.638124997, 0.378906250),
                nalgebra_glm::DVec3::new(0.345461914, -0.328907084, 0.878906250),
                nalgebra_glm::DVec3::new(0.912191792, 0.404346812, 0.066406250),
                nalgebra_glm::DVec3::new(-0.753424193, -0.333969976, 0.566406250),
                nalgebra_glm::DVec3::new(-0.384421549, 0.867241118, 0.316406250),
                nalgebra_glm::DVec3::new(0.234017942, -0.527936017, 0.816406250),
                nalgebra_glm::DVec3::new(0.353240901, 0.915742602, 0.191406250),
                nalgebra_glm::DVec3::new(-0.260011996, -0.674055754, 0.691406250),
                nalgebra_glm::DVec3::new(-0.837181318, 0.322936470, 0.441406250),
                nalgebra_glm::DVec3::new(0.314674934, -0.121383517, 0.941406250),
                nalgebra_glm::DVec3::new(0.975098978, 0.218965798, 0.035156250),
                nalgebra_glm::DVec3::new(-0.824227392, -0.185086450, 0.535156250),
                nalgebra_glm::DVec3::new(-0.210004386, 0.935191997, 0.285156250),
                nalgebra_glm::DVec3::new(0.135688898, -0.604250102, 0.785156250),
                nalgebra_glm::DVec3::new(0.528091697, 0.833947921, 0.160156250),
                nalgebra_glm::DVec3::new(-0.401851854, -0.634593424, 0.660156250),
                nalgebra_glm::DVec3::new(-0.770519351, 0.487925998, 0.410156250),
                nalgebra_glm::DVec3::new(0.349993375, -0.221630860, 0.910156250),
                nalgebra_glm::DVec3::new(0.813676926, 0.573055946, 0.097656250),
                nalgebra_glm::DVec3::new(-0.655500635, -0.461655634, 0.597656250),
                nalgebra_glm::DVec3::new(-0.539890464, 0.766585559, 0.347656250),
                nalgebra_glm::DVec3::new(0.305492637, -0.433766216, 0.847656250),
                nalgebra_glm::DVec3::new(0.166670235, 0.960544235, 0.222656250),
                nalgebra_glm::DVec3::new(-0.118170157, -0.681031393, 0.722656250),
                nalgebra_glm::DVec3::new(-0.868272852, 0.150659632, 0.472656250),
                nalgebra_glm::DVec3::new(0.228830217, -0.039705809, 0.972656250),
                nalgebra_glm::DVec3::new(0.992290216, 0.122387325, 0.019531250),
                nalgebra_glm::DVec3::new(-0.848025577, -0.104593979, 0.519531250),
                nalgebra_glm::DVec3::new(-0.117880457, 0.955749498, 0.269531250),
                nalgebra_glm::DVec3::new(0.078172578, -0.633806519, 0.769531250),
                nalgebra_glm::DVec3::new(0.608771804, 0.780068976, 0.144531250),
                nalgebra_glm::DVec3::new(-0.470392519, -0.602752309, 0.644531250),
                nalgebra_glm::DVec3::new(-0.724397755, 0.565325557, 0.394531250),
                nalgebra_glm::DVec3::new(0.352395124, -0.275011854, 0.894531250),
                nalgebra_glm::DVec3::new(0.867154587, 0.491237006, 0.082031250),
                nalgebra_glm::DVec3::new(-0.707525522, -0.400808258, 0.582031250),
                nalgebra_glm::DVec3::new(-0.464935283, 0.820725552, 0.332031250),
                nalgebra_glm::DVec3::new(0.273424804, -0.482662279, 0.832031250),
                nalgebra_glm::DVec3::new(0.260934247, 0.942895212, 0.207031250),
                nalgebra_glm::DVec3::new(-0.188614542, -0.681565379, 0.707031250),
                nalgebra_glm::DVec3::new(-0.857231236, 0.237227832, 0.457031250),
                nalgebra_glm::DVec3::new(0.279480413, -0.077342647, 0.957031250),
                nalgebra_glm::DVec3::new(0.948303099, 0.313277028, 0.050781250),
                nalgebra_glm::DVec3::new(-0.792523350, -0.261814350, 0.550781250),
                nalgebra_glm::DVec3::new(-0.299156130, 0.905558529, 0.300781250),
                nalgebra_glm::DVec3::new(0.187881848, -0.568726473, 0.800781250),
                nalgebra_glm::DVec3::new(0.442610545, 0.879316131, 0.175781250),
                nalgebra_glm::DVec3::new(-0.331409515, -0.658397627, 0.675781250),
                nalgebra_glm::DVec3::new(-0.808212688, 0.406820080, 0.425781250),
                nalgebra_glm::DVec3::new(0.337692041, -0.169979889, 0.925781250),
                nalgebra_glm::DVec3::new(0.752334664, 0.648968344, 0.113281250),
                nalgebra_glm::DVec3::new(-0.598092473, -0.515918115, 0.613281250),
                nalgebra_glm::DVec3::new(-0.608547763, 0.705475977, 0.363281250),
                nalgebra_glm::DVec3::new(0.329671471, -0.382180853, 0.863281250),
                nalgebra_glm::DVec3::new(0.071445624, 0.968564695, 0.238281250),
                nalgebra_glm::DVec3::new(-0.049618783, -0.672665424, 0.738281250),
                nalgebra_glm::DVec3::new(-0.870321743, 0.064198789, 0.488281250),
                nalgebra_glm::DVec3::new(0.152230340, -0.011229184, 0.988281250),
                nalgebra_glm::DVec3::new(0.997221976, 0.073559512, 0.011718750),
                nalgebra_glm::DVec3::new(-0.856825113, -0.063203217, 0.511718750),
                nalgebra_glm::DVec3::new(-0.071000411, 0.962529084, 0.261718750),
                nalgebra_glm::DVec3::new(0.047663056, -0.646152288, 0.761718750),
                nalgebra_glm::DVec3::new(0.647039488, 0.750098583, 0.136718750),
                nalgebra_glm::DVec3::new(-0.503659048, -0.583880807, 0.636718750),
                nalgebra_glm::DVec3::new(-0.698296261, 0.602354497, 0.386718750),
                nalgebra_glm::DVec3::new(0.350064667, -0.301967858, 0.886718750),
                nalgebra_glm::DVec3::new(0.890760775, 0.448371295, 0.074218750),
                nalgebra_glm::DVec3::new(-0.731284447, -0.368097657, 0.574218750),
                nalgebra_glm::DVec3::new(-0.425324286, 0.844974233, 0.324218750),
                nalgebra_glm::DVec3::new(0.254602098, -0.505807497, 0.824218750),
                nalgebra_glm::DVec3::new(0.307394004, 0.930494931, 0.199218750),
                nalgebra_glm::DVec3::new(-0.224253518, -0.678825087, 0.699218750),
                nalgebra_glm::DVec3::new(-0.848329177, 0.280250105, 0.449218750),
                nalgebra_glm::DVec3::new(0.298737569, -0.098689562, 0.949218750),
                nalgebra_glm::DVec3::new(0.962885938, 0.266466426, 0.042968750),
                nalgebra_glm::DVec3::new(-0.809333748, -0.223972812, 0.542968750),
                nalgebra_glm::DVec3::new(-0.255009940, 0.921487516, 0.292968750),
                nalgebra_glm::DVec3::new(0.162498031, -0.587192431, 0.792968750),
                nalgebra_glm::DVec3::new(0.485895253, 0.857725074, 0.167968750),
                nalgebra_glm::DVec3::new(-0.366809572, -0.647509449, 0.667968750),
                nalgebra_glm::DVec3::new(-0.790440450, 0.447778984, 0.417968750),
                nalgebra_glm::DVec3::new(0.345122365, -0.195509405, 0.917968750),
                nalgebra_glm::DVec3::new(0.783949518, 0.611800209, 0.105468750),
                nalgebra_glm::DVec3::new(-0.627420546, -0.489643800, 0.605468750),
                nalgebra_glm::DVec3::new(-0.575049687, 0.736858077, 0.355468750),
                nalgebra_glm::DVec3::new(0.318600409, -0.408248695, 0.855468750),
                nalgebra_glm::DVec3::new(0.119115346, 0.965761715, 0.230468750),
                nalgebra_glm::DVec3::new(-0.083599896, -0.677810049, 0.730468750),
                nalgebra_glm::DVec3::new(-0.870416310, 0.107355612, 0.480468750),
                nalgebra_glm::DVec3::new(0.195195849, -0.024075112, 0.980468750),
                nalgebra_glm::DVec3::new(0.984909237, 0.170897964, 0.027343750),
                nalgebra_glm::DVec3::new(-0.837143147, -0.145258116, 0.527343750),
                nalgebra_glm::DVec3::new(-0.164255183, 0.946625945, 0.277343750),
                nalgebra_glm::DVec3::new(0.107548032, -0.619814581, 0.777343750),
                nalgebra_glm::DVec3::new(0.569087110, 0.808041610, 0.152343750),
                nalgebra_glm::DVec3::new(-0.436418408, -0.619666527, 0.652343750),
                nalgebra_glm::DVec3::new(-0.748489634, 0.527145876, 0.402343750),
                nalgebra_glm::DVec3::new(0.352393051, -0.248183188, 0.902343750),
                nalgebra_glm::DVec3::new(0.841436870, 0.532834021, 0.089843750),
                nalgebra_glm::DVec3::new(-0.682233954, -0.432019887, 0.589843750),
                nalgebra_glm::DVec3::new(-0.503155584, 0.794569496, 0.339843750),
                nalgebra_glm::DVec3::new(0.290411805, -0.458610356, 0.839843750),
                nalgebra_glm::DVec3::new(0.213984883, 0.952917957, 0.214843750),
                nalgebra_glm::DVec3::new(-0.153214039, -0.682293098, 0.714843750),
                nalgebra_glm::DVec3::new(-0.863879574, 0.193990645, 0.464843750),
                nalgebra_glm::DVec3::new(0.256438091, -0.057585099, 0.964843750),
                nalgebra_glm::DVec3::new(0.931389834, 0.359276705, 0.058593750),
                nalgebra_glm::DVec3::new(-0.773862846, -0.298511840, 0.558593750),
                nalgebra_glm::DVec3::new(-0.342329975, 0.887457089, 0.308593750),
                nalgebra_glm::DVec3::new(0.211750492, -0.548942508, 0.808593750),
                nalgebra_glm::DVec3::new(0.398353105, 0.898670206, 0.183593750),
                nalgebra_glm::DVec3::new(-0.295770526, -0.667247616, 0.683593750),
                nalgebra_glm::DVec3::new(-0.823802147, 0.365166377, 0.433593750),
                nalgebra_glm::DVec3::new(0.327591743, -0.145211432, 0.933593750),
                nalgebra_glm::DVec3::new(0.718917403, 0.684466268, 0.121093750),
                nalgebra_glm::DVec3::new(-0.567618713, -0.540417940, 0.621093750),
                nalgebra_glm::DVec3::new(-0.640304182, 0.672532514, 0.371093750),
                nalgebra_glm::DVec3::new(0.338644923, -0.355689886, 0.871093750),
                nalgebra_glm::DVec3::new(0.023786488, 0.968954111, 0.246093750),
                nalgebra_glm::DVec3::new(-0.016340554, -0.665640370, 0.746093750),
                nalgebra_glm::DVec3::new(-0.868007456, 0.021308387, 0.496093750),
                nalgebra_glm::DVec3::new(0.088275394, -0.002167039, 0.996093750),
                nalgebra_glm::DVec3::new(0.999922795, 0.012271515, 0.001953125),
                nalgebra_glm::DVec3::new(-0.864829701, -0.010613590, 0.501953125),
                nalgebra_glm::DVec3::new(-0.011875652, 0.967666571, 0.251953125),
                nalgebra_glm::DVec3::new(0.008089601, -0.659166941, 0.751953125),
                nalgebra_glm::DVec3::new(0.692725490, 0.709939645, 0.126953125),
                nalgebra_glm::DVec3::new(-0.544074892, -0.557595096, 0.626953125),
                nalgebra_glm::DVec3::new(-0.662933035, 0.646858665, 0.376953125),
                nalgebra_glm::DVec3::new(0.343963001, -0.335622810, 0.876953125),
                nalgebra_glm::DVec3::new(0.917202771, 0.393172826, 0.064453125),
                nalgebra_glm::DVec3::new(-0.758696429, -0.325226688, 0.564453125),
            ]
        )
        .for_each(
            |(_, expected)| {
                let h = halton.hemisphere();
                assert!(h.abs_diff_eq(&expected, 1e-9));
            }
        );
    }
}