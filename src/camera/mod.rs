use crate::common::RandomGen;

pub trait Camera: std::marker::Sync {
    fn view(&self, x: f64, y: f64) -> glm::DVec3;
    fn view_with_filtering(&self, x: f64, y: f64) -> glm::DVec3;
}

pub struct SimpleCamera(f64, f64);

impl SimpleCamera {
    pub fn new(width: f64, height: f64) -> Self {
        SimpleCamera(width, height)
    }
}

impl Camera for SimpleCamera {
    fn view(&self, pixelx: f64, pixely: f64) -> glm::DVec3 {
        let fovx = std::f64::consts::PI / 4.;
        let fovy = (self.1 / self.0) * fovx;
        let vecx = ((2. * pixelx - self.0) / self.0) * fovx.tan();
        let vecy = ((2. * pixely - self.1) / self.1) * fovy.tan();
        glm::dvec3(
            vecx,
            vecy,
            -1.
        )
    }

    fn view_with_filtering(&self, pixelx: f64, pixely: f64) -> glm::DVec3 {
        let mut v = self.view(pixelx, pixely);
        v.x += RandomGen::rand() / 700.;
        v.y += RandomGen::rand() / 700.;
        v
    }
}

#[cfg(test)]
mod test {
    use super::*;
    use glm::is_approx_eq;

    const TEST_SIZE: f64 = 256.;
    
    #[test]
    fn simple_camera_test() {
        let sc = SimpleCamera::new(TEST_SIZE, TEST_SIZE);
        (0..(TEST_SIZE as i64)).zip(
            // Generated using C++ code
            vec![
                glm::DVec3::new(-1.000000000, -1.000000000, -1.000000000),
                glm::DVec3::new(-0.992187500, -0.992187500, -1.000000000),
                glm::DVec3::new(-0.984375000, -0.984375000, -1.000000000),
                glm::DVec3::new(-0.976562500, -0.976562500, -1.000000000),
                glm::DVec3::new(-0.968750000, -0.968750000, -1.000000000),
                glm::DVec3::new(-0.960937500, -0.960937500, -1.000000000),
                glm::DVec3::new(-0.953125000, -0.953125000, -1.000000000),
                glm::DVec3::new(-0.945312500, -0.945312500, -1.000000000),
                glm::DVec3::new(-0.937500000, -0.937500000, -1.000000000),
                glm::DVec3::new(-0.929687500, -0.929687500, -1.000000000),
                glm::DVec3::new(-0.921875000, -0.921875000, -1.000000000),
                glm::DVec3::new(-0.914062500, -0.914062500, -1.000000000),
                glm::DVec3::new(-0.906250000, -0.906250000, -1.000000000),
                glm::DVec3::new(-0.898437500, -0.898437500, -1.000000000),
                glm::DVec3::new(-0.890625000, -0.890625000, -1.000000000),
                glm::DVec3::new(-0.882812500, -0.882812500, -1.000000000),
                glm::DVec3::new(-0.875000000, -0.875000000, -1.000000000),
                glm::DVec3::new(-0.867187500, -0.867187500, -1.000000000),
                glm::DVec3::new(-0.859375000, -0.859375000, -1.000000000),
                glm::DVec3::new(-0.851562500, -0.851562500, -1.000000000),
                glm::DVec3::new(-0.843750000, -0.843750000, -1.000000000),
                glm::DVec3::new(-0.835937500, -0.835937500, -1.000000000),
                glm::DVec3::new(-0.828125000, -0.828125000, -1.000000000),
                glm::DVec3::new(-0.820312500, -0.820312500, -1.000000000),
                glm::DVec3::new(-0.812500000, -0.812500000, -1.000000000),
                glm::DVec3::new(-0.804687500, -0.804687500, -1.000000000),
                glm::DVec3::new(-0.796875000, -0.796875000, -1.000000000),
                glm::DVec3::new(-0.789062500, -0.789062500, -1.000000000),
                glm::DVec3::new(-0.781250000, -0.781250000, -1.000000000),
                glm::DVec3::new(-0.773437500, -0.773437500, -1.000000000),
                glm::DVec3::new(-0.765625000, -0.765625000, -1.000000000),
                glm::DVec3::new(-0.757812500, -0.757812500, -1.000000000),
                glm::DVec3::new(-0.750000000, -0.750000000, -1.000000000),
                glm::DVec3::new(-0.742187500, -0.742187500, -1.000000000),
                glm::DVec3::new(-0.734375000, -0.734375000, -1.000000000),
                glm::DVec3::new(-0.726562500, -0.726562500, -1.000000000),
                glm::DVec3::new(-0.718750000, -0.718750000, -1.000000000),
                glm::DVec3::new(-0.710937500, -0.710937500, -1.000000000),
                glm::DVec3::new(-0.703125000, -0.703125000, -1.000000000),
                glm::DVec3::new(-0.695312500, -0.695312500, -1.000000000),
                glm::DVec3::new(-0.687500000, -0.687500000, -1.000000000),
                glm::DVec3::new(-0.679687500, -0.679687500, -1.000000000),
                glm::DVec3::new(-0.671875000, -0.671875000, -1.000000000),
                glm::DVec3::new(-0.664062500, -0.664062500, -1.000000000),
                glm::DVec3::new(-0.656250000, -0.656250000, -1.000000000),
                glm::DVec3::new(-0.648437500, -0.648437500, -1.000000000),
                glm::DVec3::new(-0.640625000, -0.640625000, -1.000000000),
                glm::DVec3::new(-0.632812500, -0.632812500, -1.000000000),
                glm::DVec3::new(-0.625000000, -0.625000000, -1.000000000),
                glm::DVec3::new(-0.617187500, -0.617187500, -1.000000000),
                glm::DVec3::new(-0.609375000, -0.609375000, -1.000000000),
                glm::DVec3::new(-0.601562500, -0.601562500, -1.000000000),
                glm::DVec3::new(-0.593750000, -0.593750000, -1.000000000),
                glm::DVec3::new(-0.585937500, -0.585937500, -1.000000000),
                glm::DVec3::new(-0.578125000, -0.578125000, -1.000000000),
                glm::DVec3::new(-0.570312500, -0.570312500, -1.000000000),
                glm::DVec3::new(-0.562500000, -0.562500000, -1.000000000),
                glm::DVec3::new(-0.554687500, -0.554687500, -1.000000000),
                glm::DVec3::new(-0.546875000, -0.546875000, -1.000000000),
                glm::DVec3::new(-0.539062500, -0.539062500, -1.000000000),
                glm::DVec3::new(-0.531250000, -0.531250000, -1.000000000),
                glm::DVec3::new(-0.523437500, -0.523437500, -1.000000000),
                glm::DVec3::new(-0.515625000, -0.515625000, -1.000000000),
                glm::DVec3::new(-0.507812500, -0.507812500, -1.000000000),
                glm::DVec3::new(-0.500000000, -0.500000000, -1.000000000),
                glm::DVec3::new(-0.492187500, -0.492187500, -1.000000000),
                glm::DVec3::new(-0.484375000, -0.484375000, -1.000000000),
                glm::DVec3::new(-0.476562500, -0.476562500, -1.000000000),
                glm::DVec3::new(-0.468750000, -0.468750000, -1.000000000),
                glm::DVec3::new(-0.460937500, -0.460937500, -1.000000000),
                glm::DVec3::new(-0.453125000, -0.453125000, -1.000000000),
                glm::DVec3::new(-0.445312500, -0.445312500, -1.000000000),
                glm::DVec3::new(-0.437500000, -0.437500000, -1.000000000),
                glm::DVec3::new(-0.429687500, -0.429687500, -1.000000000),
                glm::DVec3::new(-0.421875000, -0.421875000, -1.000000000),
                glm::DVec3::new(-0.414062500, -0.414062500, -1.000000000),
                glm::DVec3::new(-0.406250000, -0.406250000, -1.000000000),
                glm::DVec3::new(-0.398437500, -0.398437500, -1.000000000),
                glm::DVec3::new(-0.390625000, -0.390625000, -1.000000000),
                glm::DVec3::new(-0.382812500, -0.382812500, -1.000000000),
                glm::DVec3::new(-0.375000000, -0.375000000, -1.000000000),
                glm::DVec3::new(-0.367187500, -0.367187500, -1.000000000),
                glm::DVec3::new(-0.359375000, -0.359375000, -1.000000000),
                glm::DVec3::new(-0.351562500, -0.351562500, -1.000000000),
                glm::DVec3::new(-0.343750000, -0.343750000, -1.000000000),
                glm::DVec3::new(-0.335937500, -0.335937500, -1.000000000),
                glm::DVec3::new(-0.328125000, -0.328125000, -1.000000000),
                glm::DVec3::new(-0.320312500, -0.320312500, -1.000000000),
                glm::DVec3::new(-0.312500000, -0.312500000, -1.000000000),
                glm::DVec3::new(-0.304687500, -0.304687500, -1.000000000),
                glm::DVec3::new(-0.296875000, -0.296875000, -1.000000000),
                glm::DVec3::new(-0.289062500, -0.289062500, -1.000000000),
                glm::DVec3::new(-0.281250000, -0.281250000, -1.000000000),
                glm::DVec3::new(-0.273437500, -0.273437500, -1.000000000),
                glm::DVec3::new(-0.265625000, -0.265625000, -1.000000000),
                glm::DVec3::new(-0.257812500, -0.257812500, -1.000000000),
                glm::DVec3::new(-0.250000000, -0.250000000, -1.000000000),
                glm::DVec3::new(-0.242187500, -0.242187500, -1.000000000),
                glm::DVec3::new(-0.234375000, -0.234375000, -1.000000000),
                glm::DVec3::new(-0.226562500, -0.226562500, -1.000000000),
                glm::DVec3::new(-0.218750000, -0.218750000, -1.000000000),
                glm::DVec3::new(-0.210937500, -0.210937500, -1.000000000),
                glm::DVec3::new(-0.203125000, -0.203125000, -1.000000000),
                glm::DVec3::new(-0.195312500, -0.195312500, -1.000000000),
                glm::DVec3::new(-0.187500000, -0.187500000, -1.000000000),
                glm::DVec3::new(-0.179687500, -0.179687500, -1.000000000),
                glm::DVec3::new(-0.171875000, -0.171875000, -1.000000000),
                glm::DVec3::new(-0.164062500, -0.164062500, -1.000000000),
                glm::DVec3::new(-0.156250000, -0.156250000, -1.000000000),
                glm::DVec3::new(-0.148437500, -0.148437500, -1.000000000),
                glm::DVec3::new(-0.140625000, -0.140625000, -1.000000000),
                glm::DVec3::new(-0.132812500, -0.132812500, -1.000000000),
                glm::DVec3::new(-0.125000000, -0.125000000, -1.000000000),
                glm::DVec3::new(-0.117187500, -0.117187500, -1.000000000),
                glm::DVec3::new(-0.109375000, -0.109375000, -1.000000000),
                glm::DVec3::new(-0.101562500, -0.101562500, -1.000000000),
                glm::DVec3::new(-0.093750000, -0.093750000, -1.000000000),
                glm::DVec3::new(-0.085937500, -0.085937500, -1.000000000),
                glm::DVec3::new(-0.078125000, -0.078125000, -1.000000000),
                glm::DVec3::new(-0.070312500, -0.070312500, -1.000000000),
                glm::DVec3::new(-0.062500000, -0.062500000, -1.000000000),
                glm::DVec3::new(-0.054687500, -0.054687500, -1.000000000),
                glm::DVec3::new(-0.046875000, -0.046875000, -1.000000000),
                glm::DVec3::new(-0.039062500, -0.039062500, -1.000000000),
                glm::DVec3::new(-0.031250000, -0.031250000, -1.000000000),
                glm::DVec3::new(-0.023437500, -0.023437500, -1.000000000),
                glm::DVec3::new(-0.015625000, -0.015625000, -1.000000000),
                glm::DVec3::new(-0.007812500, -0.007812500, -1.000000000),
                glm::DVec3::new(0.000000000, 0.000000000, -1.000000000),
                glm::DVec3::new(0.007812500, 0.007812500, -1.000000000),
                glm::DVec3::new(0.015625000, 0.015625000, -1.000000000),
                glm::DVec3::new(0.023437500, 0.023437500, -1.000000000),
                glm::DVec3::new(0.031250000, 0.031250000, -1.000000000),
                glm::DVec3::new(0.039062500, 0.039062500, -1.000000000),
                glm::DVec3::new(0.046875000, 0.046875000, -1.000000000),
                glm::DVec3::new(0.054687500, 0.054687500, -1.000000000),
                glm::DVec3::new(0.062500000, 0.062500000, -1.000000000),
                glm::DVec3::new(0.070312500, 0.070312500, -1.000000000),
                glm::DVec3::new(0.078125000, 0.078125000, -1.000000000),
                glm::DVec3::new(0.085937500, 0.085937500, -1.000000000),
                glm::DVec3::new(0.093750000, 0.093750000, -1.000000000),
                glm::DVec3::new(0.101562500, 0.101562500, -1.000000000),
                glm::DVec3::new(0.109375000, 0.109375000, -1.000000000),
                glm::DVec3::new(0.117187500, 0.117187500, -1.000000000),
                glm::DVec3::new(0.125000000, 0.125000000, -1.000000000),
                glm::DVec3::new(0.132812500, 0.132812500, -1.000000000),
                glm::DVec3::new(0.140625000, 0.140625000, -1.000000000),
                glm::DVec3::new(0.148437500, 0.148437500, -1.000000000),
                glm::DVec3::new(0.156250000, 0.156250000, -1.000000000),
                glm::DVec3::new(0.164062500, 0.164062500, -1.000000000),
                glm::DVec3::new(0.171875000, 0.171875000, -1.000000000),
                glm::DVec3::new(0.179687500, 0.179687500, -1.000000000),
                glm::DVec3::new(0.187500000, 0.187500000, -1.000000000),
                glm::DVec3::new(0.195312500, 0.195312500, -1.000000000),
                glm::DVec3::new(0.203125000, 0.203125000, -1.000000000),
                glm::DVec3::new(0.210937500, 0.210937500, -1.000000000),
                glm::DVec3::new(0.218750000, 0.218750000, -1.000000000),
                glm::DVec3::new(0.226562500, 0.226562500, -1.000000000),
                glm::DVec3::new(0.234375000, 0.234375000, -1.000000000),
                glm::DVec3::new(0.242187500, 0.242187500, -1.000000000),
                glm::DVec3::new(0.250000000, 0.250000000, -1.000000000),
                glm::DVec3::new(0.257812500, 0.257812500, -1.000000000),
                glm::DVec3::new(0.265625000, 0.265625000, -1.000000000),
                glm::DVec3::new(0.273437500, 0.273437500, -1.000000000),
                glm::DVec3::new(0.281250000, 0.281250000, -1.000000000),
                glm::DVec3::new(0.289062500, 0.289062500, -1.000000000),
                glm::DVec3::new(0.296875000, 0.296875000, -1.000000000),
                glm::DVec3::new(0.304687500, 0.304687500, -1.000000000),
                glm::DVec3::new(0.312500000, 0.312500000, -1.000000000),
                glm::DVec3::new(0.320312500, 0.320312500, -1.000000000),
                glm::DVec3::new(0.328125000, 0.328125000, -1.000000000),
                glm::DVec3::new(0.335937500, 0.335937500, -1.000000000),
                glm::DVec3::new(0.343750000, 0.343750000, -1.000000000),
                glm::DVec3::new(0.351562500, 0.351562500, -1.000000000),
                glm::DVec3::new(0.359375000, 0.359375000, -1.000000000),
                glm::DVec3::new(0.367187500, 0.367187500, -1.000000000),
                glm::DVec3::new(0.375000000, 0.375000000, -1.000000000),
                glm::DVec3::new(0.382812500, 0.382812500, -1.000000000),
                glm::DVec3::new(0.390625000, 0.390625000, -1.000000000),
                glm::DVec3::new(0.398437500, 0.398437500, -1.000000000),
                glm::DVec3::new(0.406250000, 0.406250000, -1.000000000),
                glm::DVec3::new(0.414062500, 0.414062500, -1.000000000),
                glm::DVec3::new(0.421875000, 0.421875000, -1.000000000),
                glm::DVec3::new(0.429687500, 0.429687500, -1.000000000),
                glm::DVec3::new(0.437500000, 0.437500000, -1.000000000),
                glm::DVec3::new(0.445312500, 0.445312500, -1.000000000),
                glm::DVec3::new(0.453125000, 0.453125000, -1.000000000),
                glm::DVec3::new(0.460937500, 0.460937500, -1.000000000),
                glm::DVec3::new(0.468750000, 0.468750000, -1.000000000),
                glm::DVec3::new(0.476562500, 0.476562500, -1.000000000),
                glm::DVec3::new(0.484375000, 0.484375000, -1.000000000),
                glm::DVec3::new(0.492187500, 0.492187500, -1.000000000),
                glm::DVec3::new(0.500000000, 0.500000000, -1.000000000),
                glm::DVec3::new(0.507812500, 0.507812500, -1.000000000),
                glm::DVec3::new(0.515625000, 0.515625000, -1.000000000),
                glm::DVec3::new(0.523437500, 0.523437500, -1.000000000),
                glm::DVec3::new(0.531250000, 0.531250000, -1.000000000),
                glm::DVec3::new(0.539062500, 0.539062500, -1.000000000),
                glm::DVec3::new(0.546875000, 0.546875000, -1.000000000),
                glm::DVec3::new(0.554687500, 0.554687500, -1.000000000),
                glm::DVec3::new(0.562500000, 0.562500000, -1.000000000),
                glm::DVec3::new(0.570312500, 0.570312500, -1.000000000),
                glm::DVec3::new(0.578125000, 0.578125000, -1.000000000),
                glm::DVec3::new(0.585937500, 0.585937500, -1.000000000),
                glm::DVec3::new(0.593750000, 0.593750000, -1.000000000),
                glm::DVec3::new(0.601562500, 0.601562500, -1.000000000),
                glm::DVec3::new(0.609375000, 0.609375000, -1.000000000),
                glm::DVec3::new(0.617187500, 0.617187500, -1.000000000),
                glm::DVec3::new(0.625000000, 0.625000000, -1.000000000),
                glm::DVec3::new(0.632812500, 0.632812500, -1.000000000),
                glm::DVec3::new(0.640625000, 0.640625000, -1.000000000),
                glm::DVec3::new(0.648437500, 0.648437500, -1.000000000),
                glm::DVec3::new(0.656250000, 0.656250000, -1.000000000),
                glm::DVec3::new(0.664062500, 0.664062500, -1.000000000),
                glm::DVec3::new(0.671875000, 0.671875000, -1.000000000),
                glm::DVec3::new(0.679687500, 0.679687500, -1.000000000),
                glm::DVec3::new(0.687500000, 0.687500000, -1.000000000),
                glm::DVec3::new(0.695312500, 0.695312500, -1.000000000),
                glm::DVec3::new(0.703125000, 0.703125000, -1.000000000),
                glm::DVec3::new(0.710937500, 0.710937500, -1.000000000),
                glm::DVec3::new(0.718750000, 0.718750000, -1.000000000),
                glm::DVec3::new(0.726562500, 0.726562500, -1.000000000),
                glm::DVec3::new(0.734375000, 0.734375000, -1.000000000),
                glm::DVec3::new(0.742187500, 0.742187500, -1.000000000),
                glm::DVec3::new(0.750000000, 0.750000000, -1.000000000),
                glm::DVec3::new(0.757812500, 0.757812500, -1.000000000),
                glm::DVec3::new(0.765625000, 0.765625000, -1.000000000),
                glm::DVec3::new(0.773437500, 0.773437500, -1.000000000),
                glm::DVec3::new(0.781250000, 0.781250000, -1.000000000),
                glm::DVec3::new(0.789062500, 0.789062500, -1.000000000),
                glm::DVec3::new(0.796875000, 0.796875000, -1.000000000),
                glm::DVec3::new(0.804687500, 0.804687500, -1.000000000),
                glm::DVec3::new(0.812500000, 0.812500000, -1.000000000),
                glm::DVec3::new(0.820312500, 0.820312500, -1.000000000),
                glm::DVec3::new(0.828125000, 0.828125000, -1.000000000),
                glm::DVec3::new(0.835937500, 0.835937500, -1.000000000),
                glm::DVec3::new(0.843750000, 0.843750000, -1.000000000),
                glm::DVec3::new(0.851562500, 0.851562500, -1.000000000),
                glm::DVec3::new(0.859375000, 0.859375000, -1.000000000),
                glm::DVec3::new(0.867187500, 0.867187500, -1.000000000),
                glm::DVec3::new(0.875000000, 0.875000000, -1.000000000),
                glm::DVec3::new(0.882812500, 0.882812500, -1.000000000),
                glm::DVec3::new(0.890625000, 0.890625000, -1.000000000),
                glm::DVec3::new(0.898437500, 0.898437500, -1.000000000),
                glm::DVec3::new(0.906250000, 0.906250000, -1.000000000),
                glm::DVec3::new(0.914062500, 0.914062500, -1.000000000),
                glm::DVec3::new(0.921875000, 0.921875000, -1.000000000),
                glm::DVec3::new(0.929687500, 0.929687500, -1.000000000),
                glm::DVec3::new(0.937500000, 0.937500000, -1.000000000),
                glm::DVec3::new(0.945312500, 0.945312500, -1.000000000),
                glm::DVec3::new(0.953125000, 0.953125000, -1.000000000),
                glm::DVec3::new(0.960937500, 0.960937500, -1.000000000),
                glm::DVec3::new(0.968750000, 0.968750000, -1.000000000),
                glm::DVec3::new(0.976562500, 0.976562500, -1.000000000),
                glm::DVec3::new(0.984375000, 0.984375000, -1.000000000),
                glm::DVec3::new(0.992187500, 0.992187500, -1.000000000),
                glm::DVec3::new(1.000000000, 1.000000000, -1.000000000),
                glm::DVec3::new(1.007812500, 1.007812500, -1.000000000),
                glm::DVec3::new(1.015625000, 1.015625000, -1.000000000),
                glm::DVec3::new(1.023437500, 1.023437500, -1.000000000),
                glm::DVec3::new(1.031250000, 1.031250000, -1.000000000),
                glm::DVec3::new(1.039062500, 1.039062500, -1.000000000),
                glm::DVec3::new(1.046875000, 1.046875000, -1.000000000),
                glm::DVec3::new(1.054687500, 1.054687500, -1.000000000),
                glm::DVec3::new(1.062500000, 1.062500000, -1.000000000),
            ]
        )
        .for_each(
            |(i, expected)| {
                let v = sc.view(i as f64, i as f64);
                glm::assert_approx_eq!(v, expected);
            }
        );
    }
    
    #[test]
    fn simple_camera_test2() {
        let sc = SimpleCamera::new(TEST_SIZE, TEST_SIZE);
        (0..(TEST_SIZE as i64)).zip(
            // Generated using C++ code
            vec![
                glm::DVec3::new(-1.000000000, 0.992187500, -1.000000000),
                glm::DVec3::new(-0.992187500, 0.984375000, -1.000000000),
                glm::DVec3::new(-0.984375000, 0.976562500, -1.000000000),
                glm::DVec3::new(-0.976562500, 0.968750000, -1.000000000),
                glm::DVec3::new(-0.968750000, 0.960937500, -1.000000000),
                glm::DVec3::new(-0.960937500, 0.953125000, -1.000000000),
                glm::DVec3::new(-0.953125000, 0.945312500, -1.000000000),
                glm::DVec3::new(-0.945312500, 0.937500000, -1.000000000),
                glm::DVec3::new(-0.937500000, 0.929687500, -1.000000000),
                glm::DVec3::new(-0.929687500, 0.921875000, -1.000000000),
                glm::DVec3::new(-0.921875000, 0.914062500, -1.000000000),
                glm::DVec3::new(-0.914062500, 0.906250000, -1.000000000),
                glm::DVec3::new(-0.906250000, 0.898437500, -1.000000000),
                glm::DVec3::new(-0.898437500, 0.890625000, -1.000000000),
                glm::DVec3::new(-0.890625000, 0.882812500, -1.000000000),
                glm::DVec3::new(-0.882812500, 0.875000000, -1.000000000),
                glm::DVec3::new(-0.875000000, 0.867187500, -1.000000000),
                glm::DVec3::new(-0.867187500, 0.859375000, -1.000000000),
                glm::DVec3::new(-0.859375000, 0.851562500, -1.000000000),
                glm::DVec3::new(-0.851562500, 0.843750000, -1.000000000),
                glm::DVec3::new(-0.843750000, 0.835937500, -1.000000000),
                glm::DVec3::new(-0.835937500, 0.828125000, -1.000000000),
                glm::DVec3::new(-0.828125000, 0.820312500, -1.000000000),
                glm::DVec3::new(-0.820312500, 0.812500000, -1.000000000),
                glm::DVec3::new(-0.812500000, 0.804687500, -1.000000000),
                glm::DVec3::new(-0.804687500, 0.796875000, -1.000000000),
                glm::DVec3::new(-0.796875000, 0.789062500, -1.000000000),
                glm::DVec3::new(-0.789062500, 0.781250000, -1.000000000),
                glm::DVec3::new(-0.781250000, 0.773437500, -1.000000000),
                glm::DVec3::new(-0.773437500, 0.765625000, -1.000000000),
                glm::DVec3::new(-0.765625000, 0.757812500, -1.000000000),
                glm::DVec3::new(-0.757812500, 0.750000000, -1.000000000),
                glm::DVec3::new(-0.750000000, 0.742187500, -1.000000000),
                glm::DVec3::new(-0.742187500, 0.734375000, -1.000000000),
                glm::DVec3::new(-0.734375000, 0.726562500, -1.000000000),
                glm::DVec3::new(-0.726562500, 0.718750000, -1.000000000),
                glm::DVec3::new(-0.718750000, 0.710937500, -1.000000000),
                glm::DVec3::new(-0.710937500, 0.703125000, -1.000000000),
                glm::DVec3::new(-0.703125000, 0.695312500, -1.000000000),
                glm::DVec3::new(-0.695312500, 0.687500000, -1.000000000),
                glm::DVec3::new(-0.687500000, 0.679687500, -1.000000000),
                glm::DVec3::new(-0.679687500, 0.671875000, -1.000000000),
                glm::DVec3::new(-0.671875000, 0.664062500, -1.000000000),
                glm::DVec3::new(-0.664062500, 0.656250000, -1.000000000),
                glm::DVec3::new(-0.656250000, 0.648437500, -1.000000000),
                glm::DVec3::new(-0.648437500, 0.640625000, -1.000000000),
                glm::DVec3::new(-0.640625000, 0.632812500, -1.000000000),
                glm::DVec3::new(-0.632812500, 0.625000000, -1.000000000),
                glm::DVec3::new(-0.625000000, 0.617187500, -1.000000000),
                glm::DVec3::new(-0.617187500, 0.609375000, -1.000000000),
                glm::DVec3::new(-0.609375000, 0.601562500, -1.000000000),
                glm::DVec3::new(-0.601562500, 0.593750000, -1.000000000),
                glm::DVec3::new(-0.593750000, 0.585937500, -1.000000000),
                glm::DVec3::new(-0.585937500, 0.578125000, -1.000000000),
                glm::DVec3::new(-0.578125000, 0.570312500, -1.000000000),
                glm::DVec3::new(-0.570312500, 0.562500000, -1.000000000),
                glm::DVec3::new(-0.562500000, 0.554687500, -1.000000000),
                glm::DVec3::new(-0.554687500, 0.546875000, -1.000000000),
                glm::DVec3::new(-0.546875000, 0.539062500, -1.000000000),
                glm::DVec3::new(-0.539062500, 0.531250000, -1.000000000),
                glm::DVec3::new(-0.531250000, 0.523437500, -1.000000000),
                glm::DVec3::new(-0.523437500, 0.515625000, -1.000000000),
                glm::DVec3::new(-0.515625000, 0.507812500, -1.000000000),
                glm::DVec3::new(-0.507812500, 0.500000000, -1.000000000),
                glm::DVec3::new(-0.500000000, 0.492187500, -1.000000000),
                glm::DVec3::new(-0.492187500, 0.484375000, -1.000000000),
                glm::DVec3::new(-0.484375000, 0.476562500, -1.000000000),
                glm::DVec3::new(-0.476562500, 0.468750000, -1.000000000),
                glm::DVec3::new(-0.468750000, 0.460937500, -1.000000000),
                glm::DVec3::new(-0.460937500, 0.453125000, -1.000000000),
                glm::DVec3::new(-0.453125000, 0.445312500, -1.000000000),
                glm::DVec3::new(-0.445312500, 0.437500000, -1.000000000),
                glm::DVec3::new(-0.437500000, 0.429687500, -1.000000000),
                glm::DVec3::new(-0.429687500, 0.421875000, -1.000000000),
                glm::DVec3::new(-0.421875000, 0.414062500, -1.000000000),
                glm::DVec3::new(-0.414062500, 0.406250000, -1.000000000),
                glm::DVec3::new(-0.406250000, 0.398437500, -1.000000000),
                glm::DVec3::new(-0.398437500, 0.390625000, -1.000000000),
                glm::DVec3::new(-0.390625000, 0.382812500, -1.000000000),
                glm::DVec3::new(-0.382812500, 0.375000000, -1.000000000),
                glm::DVec3::new(-0.375000000, 0.367187500, -1.000000000),
                glm::DVec3::new(-0.367187500, 0.359375000, -1.000000000),
                glm::DVec3::new(-0.359375000, 0.351562500, -1.000000000),
                glm::DVec3::new(-0.351562500, 0.343750000, -1.000000000),
                glm::DVec3::new(-0.343750000, 0.335937500, -1.000000000),
                glm::DVec3::new(-0.335937500, 0.328125000, -1.000000000),
                glm::DVec3::new(-0.328125000, 0.320312500, -1.000000000),
                glm::DVec3::new(-0.320312500, 0.312500000, -1.000000000),
                glm::DVec3::new(-0.312500000, 0.304687500, -1.000000000),
                glm::DVec3::new(-0.304687500, 0.296875000, -1.000000000),
                glm::DVec3::new(-0.296875000, 0.289062500, -1.000000000),
                glm::DVec3::new(-0.289062500, 0.281250000, -1.000000000),
                glm::DVec3::new(-0.281250000, 0.273437500, -1.000000000),
                glm::DVec3::new(-0.273437500, 0.265625000, -1.000000000),
                glm::DVec3::new(-0.265625000, 0.257812500, -1.000000000),
                glm::DVec3::new(-0.257812500, 0.250000000, -1.000000000),
                glm::DVec3::new(-0.250000000, 0.242187500, -1.000000000),
                glm::DVec3::new(-0.242187500, 0.234375000, -1.000000000),
                glm::DVec3::new(-0.234375000, 0.226562500, -1.000000000),
                glm::DVec3::new(-0.226562500, 0.218750000, -1.000000000),
                glm::DVec3::new(-0.218750000, 0.210937500, -1.000000000),
                glm::DVec3::new(-0.210937500, 0.203125000, -1.000000000),
                glm::DVec3::new(-0.203125000, 0.195312500, -1.000000000),
                glm::DVec3::new(-0.195312500, 0.187500000, -1.000000000),
                glm::DVec3::new(-0.187500000, 0.179687500, -1.000000000),
                glm::DVec3::new(-0.179687500, 0.171875000, -1.000000000),
                glm::DVec3::new(-0.171875000, 0.164062500, -1.000000000),
                glm::DVec3::new(-0.164062500, 0.156250000, -1.000000000),
                glm::DVec3::new(-0.156250000, 0.148437500, -1.000000000),
                glm::DVec3::new(-0.148437500, 0.140625000, -1.000000000),
                glm::DVec3::new(-0.140625000, 0.132812500, -1.000000000),
                glm::DVec3::new(-0.132812500, 0.125000000, -1.000000000),
                glm::DVec3::new(-0.125000000, 0.117187500, -1.000000000),
                glm::DVec3::new(-0.117187500, 0.109375000, -1.000000000),
                glm::DVec3::new(-0.109375000, 0.101562500, -1.000000000),
                glm::DVec3::new(-0.101562500, 0.093750000, -1.000000000),
                glm::DVec3::new(-0.093750000, 0.085937500, -1.000000000),
                glm::DVec3::new(-0.085937500, 0.078125000, -1.000000000),
                glm::DVec3::new(-0.078125000, 0.070312500, -1.000000000),
                glm::DVec3::new(-0.070312500, 0.062500000, -1.000000000),
                glm::DVec3::new(-0.062500000, 0.054687500, -1.000000000),
                glm::DVec3::new(-0.054687500, 0.046875000, -1.000000000),
                glm::DVec3::new(-0.046875000, 0.039062500, -1.000000000),
                glm::DVec3::new(-0.039062500, 0.031250000, -1.000000000),
                glm::DVec3::new(-0.031250000, 0.023437500, -1.000000000),
                glm::DVec3::new(-0.023437500, 0.015625000, -1.000000000),
                glm::DVec3::new(-0.015625000, 0.007812500, -1.000000000),
                glm::DVec3::new(-0.007812500, 0.000000000, -1.000000000),
                glm::DVec3::new(0.000000000, -0.007812500, -1.000000000),
                glm::DVec3::new(0.007812500, -0.015625000, -1.000000000),
                glm::DVec3::new(0.015625000, -0.023437500, -1.000000000),
                glm::DVec3::new(0.023437500, -0.031250000, -1.000000000),
                glm::DVec3::new(0.031250000, -0.039062500, -1.000000000),
                glm::DVec3::new(0.039062500, -0.046875000, -1.000000000),
                glm::DVec3::new(0.046875000, -0.054687500, -1.000000000),
                glm::DVec3::new(0.054687500, -0.062500000, -1.000000000),
                glm::DVec3::new(0.062500000, -0.070312500, -1.000000000),
                glm::DVec3::new(0.070312500, -0.078125000, -1.000000000),
                glm::DVec3::new(0.078125000, -0.085937500, -1.000000000),
                glm::DVec3::new(0.085937500, -0.093750000, -1.000000000),
                glm::DVec3::new(0.093750000, -0.101562500, -1.000000000),
                glm::DVec3::new(0.101562500, -0.109375000, -1.000000000),
                glm::DVec3::new(0.109375000, -0.117187500, -1.000000000),
                glm::DVec3::new(0.117187500, -0.125000000, -1.000000000),
                glm::DVec3::new(0.125000000, -0.132812500, -1.000000000),
                glm::DVec3::new(0.132812500, -0.140625000, -1.000000000),
                glm::DVec3::new(0.140625000, -0.148437500, -1.000000000),
                glm::DVec3::new(0.148437500, -0.156250000, -1.000000000),
                glm::DVec3::new(0.156250000, -0.164062500, -1.000000000),
                glm::DVec3::new(0.164062500, -0.171875000, -1.000000000),
                glm::DVec3::new(0.171875000, -0.179687500, -1.000000000),
                glm::DVec3::new(0.179687500, -0.187500000, -1.000000000),
                glm::DVec3::new(0.187500000, -0.195312500, -1.000000000),
                glm::DVec3::new(0.195312500, -0.203125000, -1.000000000),
                glm::DVec3::new(0.203125000, -0.210937500, -1.000000000),
                glm::DVec3::new(0.210937500, -0.218750000, -1.000000000),
                glm::DVec3::new(0.218750000, -0.226562500, -1.000000000),
                glm::DVec3::new(0.226562500, -0.234375000, -1.000000000),
                glm::DVec3::new(0.234375000, -0.242187500, -1.000000000),
                glm::DVec3::new(0.242187500, -0.250000000, -1.000000000),
                glm::DVec3::new(0.250000000, -0.257812500, -1.000000000),
                glm::DVec3::new(0.257812500, -0.265625000, -1.000000000),
                glm::DVec3::new(0.265625000, -0.273437500, -1.000000000),
                glm::DVec3::new(0.273437500, -0.281250000, -1.000000000),
                glm::DVec3::new(0.281250000, -0.289062500, -1.000000000),
                glm::DVec3::new(0.289062500, -0.296875000, -1.000000000),
                glm::DVec3::new(0.296875000, -0.304687500, -1.000000000),
                glm::DVec3::new(0.304687500, -0.312500000, -1.000000000),
                glm::DVec3::new(0.312500000, -0.320312500, -1.000000000),
                glm::DVec3::new(0.320312500, -0.328125000, -1.000000000),
                glm::DVec3::new(0.328125000, -0.335937500, -1.000000000),
                glm::DVec3::new(0.335937500, -0.343750000, -1.000000000),
                glm::DVec3::new(0.343750000, -0.351562500, -1.000000000),
                glm::DVec3::new(0.351562500, -0.359375000, -1.000000000),
                glm::DVec3::new(0.359375000, -0.367187500, -1.000000000),
                glm::DVec3::new(0.367187500, -0.375000000, -1.000000000),
                glm::DVec3::new(0.375000000, -0.382812500, -1.000000000),
                glm::DVec3::new(0.382812500, -0.390625000, -1.000000000),
                glm::DVec3::new(0.390625000, -0.398437500, -1.000000000),
                glm::DVec3::new(0.398437500, -0.406250000, -1.000000000),
                glm::DVec3::new(0.406250000, -0.414062500, -1.000000000),
                glm::DVec3::new(0.414062500, -0.421875000, -1.000000000),
                glm::DVec3::new(0.421875000, -0.429687500, -1.000000000),
                glm::DVec3::new(0.429687500, -0.437500000, -1.000000000),
                glm::DVec3::new(0.437500000, -0.445312500, -1.000000000),
                glm::DVec3::new(0.445312500, -0.453125000, -1.000000000),
                glm::DVec3::new(0.453125000, -0.460937500, -1.000000000),
                glm::DVec3::new(0.460937500, -0.468750000, -1.000000000),
                glm::DVec3::new(0.468750000, -0.476562500, -1.000000000),
                glm::DVec3::new(0.476562500, -0.484375000, -1.000000000),
                glm::DVec3::new(0.484375000, -0.492187500, -1.000000000),
                glm::DVec3::new(0.492187500, -0.500000000, -1.000000000),
                glm::DVec3::new(0.500000000, -0.507812500, -1.000000000),
                glm::DVec3::new(0.507812500, -0.515625000, -1.000000000),
                glm::DVec3::new(0.515625000, -0.523437500, -1.000000000),
                glm::DVec3::new(0.523437500, -0.531250000, -1.000000000),
                glm::DVec3::new(0.531250000, -0.539062500, -1.000000000),
                glm::DVec3::new(0.539062500, -0.546875000, -1.000000000),
                glm::DVec3::new(0.546875000, -0.554687500, -1.000000000),
                glm::DVec3::new(0.554687500, -0.562500000, -1.000000000),
                glm::DVec3::new(0.562500000, -0.570312500, -1.000000000),
                glm::DVec3::new(0.570312500, -0.578125000, -1.000000000),
                glm::DVec3::new(0.578125000, -0.585937500, -1.000000000),
                glm::DVec3::new(0.585937500, -0.593750000, -1.000000000),
                glm::DVec3::new(0.593750000, -0.601562500, -1.000000000),
                glm::DVec3::new(0.601562500, -0.609375000, -1.000000000),
                glm::DVec3::new(0.609375000, -0.617187500, -1.000000000),
                glm::DVec3::new(0.617187500, -0.625000000, -1.000000000),
                glm::DVec3::new(0.625000000, -0.632812500, -1.000000000),
                glm::DVec3::new(0.632812500, -0.640625000, -1.000000000),
                glm::DVec3::new(0.640625000, -0.648437500, -1.000000000),
                glm::DVec3::new(0.648437500, -0.656250000, -1.000000000),
                glm::DVec3::new(0.656250000, -0.664062500, -1.000000000),
                glm::DVec3::new(0.664062500, -0.671875000, -1.000000000),
                glm::DVec3::new(0.671875000, -0.679687500, -1.000000000),
                glm::DVec3::new(0.679687500, -0.687500000, -1.000000000),
                glm::DVec3::new(0.687500000, -0.695312500, -1.000000000),
                glm::DVec3::new(0.695312500, -0.703125000, -1.000000000),
                glm::DVec3::new(0.703125000, -0.710937500, -1.000000000),
                glm::DVec3::new(0.710937500, -0.718750000, -1.000000000),
                glm::DVec3::new(0.718750000, -0.726562500, -1.000000000),
                glm::DVec3::new(0.726562500, -0.734375000, -1.000000000),
                glm::DVec3::new(0.734375000, -0.742187500, -1.000000000),
                glm::DVec3::new(0.742187500, -0.750000000, -1.000000000),
                glm::DVec3::new(0.750000000, -0.757812500, -1.000000000),
                glm::DVec3::new(0.757812500, -0.765625000, -1.000000000),
                glm::DVec3::new(0.765625000, -0.773437500, -1.000000000),
                glm::DVec3::new(0.773437500, -0.781250000, -1.000000000),
                glm::DVec3::new(0.781250000, -0.789062500, -1.000000000),
                glm::DVec3::new(0.789062500, -0.796875000, -1.000000000),
                glm::DVec3::new(0.796875000, -0.804687500, -1.000000000),
                glm::DVec3::new(0.804687500, -0.812500000, -1.000000000),
                glm::DVec3::new(0.812500000, -0.820312500, -1.000000000),
                glm::DVec3::new(0.820312500, -0.828125000, -1.000000000),
                glm::DVec3::new(0.828125000, -0.835937500, -1.000000000),
                glm::DVec3::new(0.835937500, -0.843750000, -1.000000000),
                glm::DVec3::new(0.843750000, -0.851562500, -1.000000000),
                glm::DVec3::new(0.851562500, -0.859375000, -1.000000000),
                glm::DVec3::new(0.859375000, -0.867187500, -1.000000000),
                glm::DVec3::new(0.867187500, -0.875000000, -1.000000000),
                glm::DVec3::new(0.875000000, -0.882812500, -1.000000000),
                glm::DVec3::new(0.882812500, -0.890625000, -1.000000000),
                glm::DVec3::new(0.890625000, -0.898437500, -1.000000000),
                glm::DVec3::new(0.898437500, -0.906250000, -1.000000000),
                glm::DVec3::new(0.906250000, -0.914062500, -1.000000000),
                glm::DVec3::new(0.914062500, -0.921875000, -1.000000000),
                glm::DVec3::new(0.921875000, -0.929687500, -1.000000000),
                glm::DVec3::new(0.929687500, -0.937500000, -1.000000000),
                glm::DVec3::new(0.937500000, -0.945312500, -1.000000000),
                glm::DVec3::new(0.945312500, -0.953125000, -1.000000000),
                glm::DVec3::new(0.953125000, -0.960937500, -1.000000000),
                glm::DVec3::new(0.960937500, -0.968750000, -1.000000000),
                glm::DVec3::new(0.968750000, -0.976562500, -1.000000000),
                glm::DVec3::new(0.976562500, -0.984375000, -1.000000000),
                glm::DVec3::new(0.984375000, -0.992187500, -1.000000000),
                glm::DVec3::new(0.992187500, -1.000000000, -1.000000000),
                glm::DVec3::new(1.000000000, -1.007812500, -1.000000000),
                glm::DVec3::new(1.007812500, -1.015625000, -1.000000000),
                glm::DVec3::new(1.015625000, -1.023437500, -1.000000000),
                glm::DVec3::new(1.023437500, -1.031250000, -1.000000000),
                glm::DVec3::new(1.031250000, -1.039062500, -1.000000000),
                glm::DVec3::new(1.039062500, -1.046875000, -1.000000000),
                glm::DVec3::new(1.046875000, -1.054687500, -1.000000000),
                glm::DVec3::new(1.054687500, -1.062500000, -1.000000000),
                glm::DVec3::new(1.062500000, -1.070312500, -1.000000000),
            ]
        )
        .for_each(
            |(i, expected)| {
                let v = sc.view(i as f64, TEST_SIZE - (i as f64 + 1.));
                glm::assert_approx_eq!(v, expected);
            }
        );
    }
}